# ­Ъњ░ рЃАрЃљрЃџрЃљрЃарЃЮрЃА рЃАрЃўрЃАрЃбрЃћрЃЏрЃўрЃА рЃЏрЃБрЃерЃљрЃЮрЃЉрЃўрЃА рЃърЃарЃўрЃюрЃфрЃўрЃърЃў

## ­ЪЊІ рЃќрЃЮрЃњрЃљрЃЊрЃў рЃўрЃюрЃцрЃЮрЃарЃЏрЃљрЃфрЃўрЃљ

рЃАрЃљрЃџрЃљрЃарЃЮрЃА рЃАрЃўрЃАрЃбрЃћрЃЏрЃљ (`CashierModule.tsx`) рЃљрЃарЃўрЃА рЃцрЃўрЃюрЃљрЃюрЃАрЃБрЃарЃў рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃћрЃЉрЃўрЃА рЃЏрЃљрЃарЃЌрЃЋрЃўрЃА рЃАрЃўрЃАрЃбрЃћрЃЏрЃљ, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃљрЃЎрЃЮрЃюрЃбрЃарЃЮрЃџрЃћрЃЉрЃА:
- рЃњрЃљрЃЊрЃљрЃ«рЃЊрЃћрЃЉрЃА (Folio-рЃЊрЃљрЃю)
- рЃ«рЃћрЃџрЃўрЃЌ рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃћрЃЉрЃА (рЃерЃћрЃЏрЃЮрЃАрЃљрЃЋрЃџрЃћрЃЉрЃў рЃЊрЃљ рЃ«рЃљрЃарЃ»рЃћрЃЉрЃў)
- Shift-рЃћрЃЉрЃўрЃА рЃЏрЃљрЃарЃЌрЃЋрЃљрЃА (рЃњрЃљрЃ«рЃАрЃюрЃљ/рЃЊрЃљрЃ«рЃБрЃарЃЋрЃљ)
- X-Report-рЃћрЃЉрЃўрЃА рЃњрЃћрЃюрЃћрЃарЃљрЃфрЃўрЃљрЃА

---

## ­Ъћё рЃАрЃљрЃџрЃљрЃарЃЮрЃА рЃЏрЃБрЃерЃљрЃЮрЃЉрЃўрЃА рЃФрЃўрЃарЃўрЃЌрЃљрЃЊрЃў рЃърЃарЃўрЃюрЃфрЃўрЃърЃў

### 1. **Shift (рЃфрЃЋрЃџрЃљ) рЃЏрЃљрЃарЃЌрЃЋрЃљ**

#### Shift-рЃўрЃА рЃњрЃљрЃ«рЃАрЃюрЃљ:
```typescript
// File: CashierModule.tsx:281
const openShift = (openingBalance: number) => {
  const newShift: CashierShift = {
    id: Date.now().toString(),
    userId: user.id,
    userName: user.name,
    openingBalance,  // рЃАрЃљрЃгрЃДрЃўрЃАрЃў рЃЉрЃљрЃџрЃљрЃюрЃАрЃў
    cashCollected: 0,
    cardPayments: 0,
    bankTransfers: 0,
    expenses: 0,
    totalCollected: 0,
    expectedAmount: openingBalance,
    discrepancy: 0,
    openedAt: new Date().toISOString(),
    status: 'open'
  }
  
  // рЃўрЃюрЃљрЃ«рЃћрЃЉрЃљ localStorage-рЃерЃў
  localStorage.setItem('currentCashierShift', JSON.stringify(newShift))
}
```

**рЃарЃЮрЃњрЃЮрЃа рЃЏрЃБрЃерЃљрЃЮрЃЉрЃА:**
- рЃЏрЃЮрЃџрЃљрЃарЃћ рЃерЃћрЃўрЃДрЃЋрЃљрЃюрЃА рЃАрЃљрЃгрЃДрЃўрЃА рЃЉрЃљрЃџрЃљрЃюрЃАрЃА (рЃюрЃљрЃдрЃЊрЃў рЃцрЃБрЃџрЃў)
- рЃАрЃўрЃАрЃбрЃћрЃЏрЃљ рЃўрЃЦрЃЏрЃюрЃўрЃА рЃљрЃ«рЃљрЃџ Shift-рЃА `status: 'open'`-рЃўрЃЌ
- Shift рЃўрЃюрЃљрЃ«рЃћрЃЉрЃљ `localStorage.getItem('currentCashierShift')`-рЃерЃў

---

### 2. **рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃћрЃЉрЃўрЃА рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃў рЃерЃћрЃњрЃарЃЮрЃЋрЃћрЃЉрЃљ**

#### Folio рЃњрЃљрЃЊрЃљрЃ«рЃЊрЃћрЃЉрЃўрЃА рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃў рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃљ:
```typescript
// File: CashierModule.tsx:64-100
const loadCashierTransactions = () => {
  const folios = JSON.parse(localStorage.getItem('hotelFolios') || '[]')
  const today = getBusinessDate()  // Business Day (рЃљрЃарЃљ рЃЊрЃдрЃћрЃА!)
  
  const todayTransactions: any[] = []
  
  folios.forEach((folio: any) => {
    folio.transactions.forEach((t: any) => {
      const txDate = t.date
      const isPayment = t.credit > 0  // рЃњрЃљрЃЊрЃљрЃ«рЃЊрЃљ = credit > 0
      const isToday = txDate === today
      
      if (isPayment && isToday) {
        todayTransactions.push({
          id: t.id,
          time: t.time,
          date: txDate,
          type: 'income',  // рЃерЃћрЃЏрЃЮрЃАрЃљрЃЋрЃљрЃџрЃў
          category: t.paymentMethod || 'cash',
          description: `${folio.guestName} - Room ${folio.roomNumber}`,
          amount: t.credit,
          method: t.paymentMethod || 'cash',  // cash, card, bank
          reference: folio.folioNumber,
          manual: false  // рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃў (Folio-рЃЊрЃљрЃю)
        })
      }
    })
  })
  
  return todayTransactions
}
```

**рЃарЃЮрЃњрЃЮрЃа рЃЏрЃБрЃерЃљрЃЮрЃЉрЃА:**
- рЃАрЃўрЃАрЃбрЃћрЃЏрЃљ рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃљрЃњрЃарЃЮрЃЋрЃћрЃЉрЃА **рЃДрЃЋрЃћрЃџрЃљ Folio-рЃА рЃњрЃљрЃЊрЃљрЃ«рЃЊрЃћрЃЉрЃА** Business Day-рЃќрЃћ
- рЃњрЃљрЃЊрЃљрЃ«рЃЊрЃћрЃЉрЃў рЃўрЃДрЃЮрЃцрЃљ рЃЏрЃћрЃЌрЃЮрЃЊрЃћрЃЉрЃўрЃА рЃЏрЃўрЃ«рЃћрЃЊрЃЋрЃўрЃЌ: **рЃюрЃљрЃдрЃЊрЃў**, **рЃЉрЃљрЃарЃљрЃЌрЃў**, **рЃЉрЃљрЃюрЃЎрЃў**
- рЃДрЃЮрЃЋрЃћрЃџрЃў рЃњрЃљрЃЊрЃљрЃ«рЃЊрЃљ рЃљрЃЕрЃЋрЃћрЃюрЃћрЃЉрЃА: рЃАрЃбрЃБрЃЏрЃарЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў, рЃЮрЃЌрЃљрЃ«рЃў, рЃЌрЃљрЃюрЃ«рЃљ, рЃЏрЃћрЃЌрЃЮрЃЊрЃў

---

### 3. **рЃ«рЃћрЃџрЃўрЃЌ рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃћрЃЉрЃўрЃА рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃљ**

#### рЃерЃћрЃЏрЃЮрЃАрЃљрЃЋрЃџрЃўрЃА рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃљ:
```typescript
// File: CashierModule.tsx:306
const addManualTransaction = () => {
  const transaction = {
    id: `MANUAL-${Date.now()}`,
    time: moment().format('HH:mm:ss'),
    date: getBusinessDate(),
    type: 'income',  // рЃљрЃю 'expense'
    category: 'deposit',  // рЃЊрЃћрЃърЃЮрЃќрЃўрЃбрЃў, рЃгрЃўрЃюрЃљрЃАрЃгрЃљрЃарЃў рЃњрЃљрЃЊрЃљрЃ«рЃЊрЃљ, рЃАрЃ«рЃЋрЃљ
    description: 'рЃАрЃбрЃБрЃЏрЃарЃўрЃА рЃЊрЃћрЃърЃЮрЃќрЃўрЃбрЃў',
    amount: 100,
    method: 'cash',  // cash, card, bank
    manual: true,  // рЃ«рЃћрЃџрЃўрЃЌ рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃБрЃџрЃў
    shiftId: currentShift.id
  }
  
  // рЃўрЃюрЃљрЃ«рЃћрЃЉрЃљ localStorage-рЃерЃў
  const saved = JSON.parse(localStorage.getItem('cashierManualTransactions') || '[]')
  saved.push(transaction)
  localStorage.setItem('cashierManualTransactions', JSON.stringify(saved))
  
  // рЃЌрЃБ income Рєњ рЃЊрЃљрЃћрЃЏрЃљрЃбрЃћрЃЉрЃљ transactions-рЃА
  // рЃЌрЃБ expense Рєњ рЃЊрЃљрЃћрЃЏрЃљрЃбрЃћрЃЉрЃљ manualTransactions-рЃА
}
```

**рЃарЃЮрЃњрЃЮрЃа рЃЏрЃБрЃерЃљрЃЮрЃЉрЃА:**
- рЃЏрЃЮрЃџрЃљрЃарЃћ рЃерЃћрЃўрЃДрЃЋрЃљрЃюрЃА: **рЃбрЃўрЃърЃў** (рЃерЃћрЃЏрЃЮрЃАрЃљрЃЋрЃљрЃџрЃў/рЃ«рЃљрЃарЃ»рЃў), **рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃљ**, **рЃљрЃдрЃгрЃћрЃарЃљ**, **рЃЌрЃљрЃюрЃ«рЃљ**, **рЃЏрЃћрЃЌрЃЮрЃЊрЃў**
- рЃерЃћрЃЏрЃЮрЃАрЃљрЃЋрЃљрЃџрЃў Рєњ рЃЊрЃљрЃћрЃЏрЃљрЃбрЃћрЃЉрЃљ `transactions`-рЃА (рЃўрЃЌрЃЋрЃџрЃћрЃЉрЃљ cash/card/bank-рЃерЃў)
- рЃ«рЃљрЃарЃ»рЃў Рєњ рЃЊрЃљрЃћрЃЏрЃљрЃбрЃћрЃЉрЃљ `manualTransactions`-рЃА (рЃњрЃљрЃЏрЃЮрЃљрЃЎрЃџрЃЊрЃћрЃЉрЃљ рЃерЃћрЃЏрЃЮрЃАрЃљрЃЋрЃљрЃџрЃА)

---

### 4. **рЃАрЃљрЃЉрЃљрЃџрЃљрЃюрЃАрЃЮ рЃњрЃљрЃЏрЃЮрЃЌрЃЋрЃџрЃљ**

#### рЃюрЃљрЃдрЃЊрЃў/рЃЉрЃљрЃарЃљрЃЌрЃў/рЃЉрЃљрЃюрЃЎрЃў рЃњрЃљрЃЏрЃЮрЃЌрЃЋрЃџрЃљ:
```typescript
// File: CashierModule.tsx:177
const calculatedTotals = useMemo(() => {
  let cash = 0, card = 0, bank = 0
  
  // рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ income рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃћрЃЉрЃў
  transactions.forEach(t => {
    const amount = t.amount || 0
    if (t.method === 'cash' || t.method === 'CASH') cash += amount
    else if (t.method === 'card' || t.method === 'CARD') card += amount
    else if (t.method === 'bank' || t.method === 'BANK') bank += amount
  })
  
  // рЃ«рЃљрЃарЃ»рЃћрЃЉрЃў (рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ manual expenses)
  const totalExpenses = manualTransactions
    .filter(t => t.type === 'expense')
    .reduce((sum, t) => sum + (t.amount || 0), 0)
  
  return { 
    cash,      // ­Ъњх рЃюрЃљрЃдрЃЊрЃў рЃерЃћрЃЏрЃЮрЃАрЃљрЃЋрЃљрЃџрЃў
    card,      // ­Ъњ│ рЃЉрЃљрЃарЃљрЃЌрЃўрЃЌ рЃерЃћрЃЏрЃЮрЃАрЃљрЃЋрЃљрЃџрЃў
    bank,      // ­ЪЈд рЃЉрЃљрЃюрЃЎрЃўрЃЌ рЃерЃћрЃЏрЃЮрЃАрЃљрЃЋрЃљрЃџрЃў
    total: cash + card + bank,  // ­ЪЊі рЃАрЃБрЃџ рЃерЃћрЃЏрЃЮрЃАрЃљрЃЋрЃљрЃџрЃў
    expenses: totalExpenses,    // ­ЪњИ рЃ«рЃљрЃарЃ»рЃћрЃЉрЃў
    net: cash + card + bank - totalExpenses  // рЃгрЃЏрЃўрЃюрЃЊрЃљ рЃерЃћрЃЏрЃЮрЃАрЃљрЃЋрЃљрЃџрЃў
  }
}, [transactions, manualTransactions])
```

**рЃарЃЮрЃњрЃЮрЃа рЃЏрЃБрЃерЃљрЃЮрЃЉрЃА:**
- **рЃюрЃљрЃдрЃЊрЃў**: рЃДрЃЋрЃћрЃџрЃљ `method === 'cash'` рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃўрЃА рЃ»рЃљрЃЏрЃў
- **рЃЉрЃљрЃарЃљрЃЌрЃў**: рЃДрЃЋрЃћрЃџрЃљ `method === 'card'` рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃўрЃА рЃ»рЃљрЃЏрЃў
- **рЃЉрЃљрЃюрЃЎрЃў**: рЃДрЃЋрЃћрЃџрЃљ `method === 'bank'` рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃўрЃА рЃ»рЃљрЃЏрЃў
- **рЃ«рЃљрЃарЃ»рЃћрЃЉрЃў**: рЃДрЃЋрЃћрЃџрЃљ `type === 'expense'` рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃўрЃА рЃ»рЃљрЃЏрЃў
- **рЃгрЃЏрЃўрЃюрЃЊрЃљ**: рЃерЃћрЃЏрЃЮрЃАрЃљрЃЋрЃљрЃџрЃў - рЃ«рЃљрЃарЃ»рЃћрЃЉрЃў

---

### 5. **Shift-рЃўрЃА рЃЊрЃљрЃ«рЃБрЃарЃЋрЃљ**

#### рЃЊрЃљрЃ«рЃБрЃарЃЋрЃўрЃА рЃърЃарЃЮрЃфрЃћрЃАрЃў:
```typescript
// File: CashierModule.tsx:372
const handleCloseShift = () => {
  // рЃЏрЃЮрЃАрЃљрЃџрЃЮрЃЊрЃюрЃћрЃџрЃў рЃюрЃљрЃдрЃЊрЃў = рЃАрЃљрЃгрЃДрЃўрЃАрЃў + рЃюрЃљрЃдрЃЊрЃў рЃерЃћрЃЏрЃЮрЃАрЃљрЃЋрЃљрЃџрЃў - рЃ«рЃљрЃарЃ»рЃћрЃЉрЃў
  const expectedCash = (currentShift.openingBalance || 0) + calculatedTotals.cash - calculatedTotals.expenses
  
  // рЃЏрЃЮрЃџрЃљрЃарЃћ рЃерЃћрЃўрЃДрЃЋрЃљрЃюрЃА рЃцрЃљрЃЦрЃбрЃўрЃБрЃа рЃюрЃљрЃдрЃЊрЃА
  const actualCash = closeFormData.actualCash
  
  // рЃАрЃ«рЃЋрЃљрЃЮрЃЉрЃљ (discrepancy)
  const discrepancy = actualCash - expectedCash
  
  // рЃњрЃљрЃАрЃљрЃбрЃљрЃюрЃў рЃЌрЃљрЃюрЃ«рЃљ = рЃцрЃљрЃЦрЃбрЃўрЃБрЃарЃў - рЃерЃћрЃЏрЃЊрЃћрЃњрЃў рЃЊрЃдрЃўрЃАрЃЌрЃЋрЃўрЃА рЃЊрЃљрЃбрЃЮрЃЋрЃћрЃЉрЃБрЃџрЃў
  const withdrawal = actualCash - closeFormData.nextDayBalance
  
  const closedShift = {
    ...currentShift,
    closedAt: new Date().toISOString(),
    status: 'closed',
    cashCollected: calculatedTotals.cash,
    cardPayments: calculatedTotals.card,
    bankTransfers: calculatedTotals.bank,
    expenses: calculatedTotals.expenses,
    totalCollected: calculatedTotals.total,
    expectedAmount: expectedCash,
    actualAmount: actualCash,
    discrepancy: discrepancy,
    withdrawal: withdrawal,
    nextDayOpening: closeFormData.nextDayBalance,  // рЃерЃћрЃЏрЃЊрЃћрЃњрЃў рЃЊрЃдрЃўрЃАрЃЌрЃЋрЃўрЃА
    transactions: [...transactions],  // рЃДрЃЋрЃћрЃџрЃљ рЃерЃћрЃЏрЃЮрЃАрЃљрЃЋрЃљрЃџрЃў
    manualTransactions: [...todayManualTx]  // рЃДрЃЋрЃћрЃџрЃљ рЃ«рЃљрЃарЃ»рЃў
  }
  
  // рЃўрЃюрЃљрЃ«рЃћрЃЉрЃљ рЃўрЃАрЃбрЃЮрЃарЃўрЃљрЃерЃў
  const history = JSON.parse(localStorage.getItem('cashierShifts') || '[]')
  history.push(closedShift)
  localStorage.setItem('cashierShifts', JSON.stringify(history))
  
  // рЃгрЃљрЃерЃџрЃўрЃА currentCashierShift
  localStorage.removeItem('currentCashierShift')
}
```

**рЃарЃЮрЃњрЃЮрЃа рЃЏрЃБрЃерЃљрЃЮрЃЉрЃА:**
1. рЃАрЃўрЃАрЃбрЃћрЃЏрЃљ рЃњрЃљрЃЏрЃЮрЃЌрЃЋрЃџрЃўрЃА **рЃЏрЃЮрЃАрЃљрЃџрЃЮрЃЊрЃюрЃћрЃџ рЃюрЃљрЃдрЃЊрЃА**: `рЃАрЃљрЃгрЃДрЃўрЃАрЃў + рЃюрЃљрЃдрЃЊрЃў рЃерЃћрЃЏрЃЮрЃАрЃљрЃЋрЃљрЃџрЃў - рЃ«рЃљрЃарЃ»рЃћрЃЉрЃў`
2. рЃЏрЃЮрЃџрЃљрЃарЃћ рЃерЃћрЃўрЃДрЃЋрЃљрЃюрЃА **рЃцрЃљрЃЦрЃбрЃўрЃБрЃа рЃюрЃљрЃдрЃЊрЃА** (рЃарЃћрЃљрЃџрЃБрЃарЃљрЃЊ рЃЊрЃљрЃЌрЃЋрЃџрЃўрЃџрЃў)
3. рЃАрЃўрЃАрЃбрЃћрЃЏрЃљ рЃњрЃљрЃЏрЃЮрЃЌрЃЋрЃџрЃўрЃА **рЃАрЃ«рЃЋрЃљрЃЮрЃЉрЃљрЃА**: `рЃцрЃљрЃЦрЃбрЃўрЃБрЃарЃў - рЃЏрЃЮрЃАрЃљрЃџрЃЮрЃЊрЃюрЃћрЃџрЃў`
4. рЃЏрЃЮрЃџрЃљрЃарЃћ рЃерЃћрЃўрЃДрЃЋрЃљрЃюрЃА **рЃерЃћрЃЏрЃЊрЃћрЃњрЃў рЃЊрЃдрЃўрЃАрЃЌрЃЋрЃўрЃА рЃЊрЃљрЃбрЃЮрЃЋрЃћрЃЉрЃБрЃџ рЃЌрЃљрЃюрЃ«рЃљрЃА**
5. рЃАрЃўрЃАрЃбрЃћрЃЏрЃљ рЃњрЃљрЃЏрЃЮрЃЌрЃЋрЃџрЃўрЃА **рЃњрЃљрЃАрЃљрЃбрЃљрЃю рЃЌрЃљрЃюрЃ«рЃљрЃА**: `рЃцрЃљрЃЦрЃбрЃўрЃБрЃарЃў - рЃерЃћрЃЏрЃЊрЃћрЃњрЃў рЃЊрЃдрЃўрЃАрЃЌрЃЋрЃўрЃА`
6. Shift рЃўрЃюрЃљрЃ«рЃћрЃЉрЃљ рЃўрЃАрЃбрЃЮрЃарЃўрЃљрЃерЃў рЃЊрЃљ рЃгрЃљрЃўрЃерЃџрЃћрЃЉрЃљ currentCashierShift

---

### 6. **X-Report (рЃЏрЃўрЃЏрЃЊрЃўрЃюрЃљрЃарЃћ рЃљрЃюрЃњрЃљрЃарЃўрЃерЃў)**

#### X-Report рЃњрЃћрЃюрЃћрЃарЃљрЃфрЃўрЃљ:
```typescript
// File: CashierModule.tsx:345
const generateXReport = () => {
  const allTransactions = [...transactions, ...manualTransactions]
  const totals = calculateCashierTotals(allTransactions.filter(t => t.type === 'income'))
  const expenses = allTransactions.filter(t => t.type === 'expense')
  const totalExpenses = expenses.reduce((sum, t) => sum + t.amount, 0)
  
  return {
    shiftId: currentShift.id,
    reportTime: moment().format('DD/MM/YYYY HH:mm:ss'),
    cashier: currentShift.userName,
    openedAt: moment(currentShift.openedAt).format('DD/MM/YYYY HH:mm'),
    openingBalance: currentShift.openingBalance,
    cashSales: totals.cash,      // ­Ъњх рЃюрЃљрЃдрЃЊрЃў
    cardSales: totals.card,      // ­Ъњ│ рЃЉрЃљрЃарЃљрЃЌрЃў
    bankTransfers: totals.bank,  // ­ЪЈд рЃЉрЃљрЃюрЃЎрЃў
    totalSales: totals.total,    // ­ЪЊі рЃАрЃБрЃџ
    expenses: totalExpenses,      // ­ЪњИ рЃ«рЃљрЃарЃ»рЃћрЃЉрЃў
    expectedCash: currentShift.openingBalance + totals.cash - totalExpenses,  // рЃЏрЃЮрЃАрЃљрЃџрЃЮрЃЊрЃюрЃћрЃџрЃў
    transactionCount: allTransactions.length
  }
}
```

**рЃарЃЮрЃњрЃЮрЃа рЃЏрЃБрЃерЃљрЃЮрЃЉрЃА:**
- X-Report рЃљрЃЕрЃЋрЃћрЃюрЃћрЃЉрЃА **рЃЏрЃўрЃЏрЃЊрЃўрЃюрЃљрЃарЃћ Shift-рЃўрЃА рЃАрЃбрЃљрЃбрЃўрЃАрЃбрЃўрЃЎрЃљрЃА** (Shift рЃЊрЃљрЃ«рЃБрЃарЃЋрЃљрЃЏрЃЊрЃћ)
- рЃерЃћрЃўрЃФрЃџрЃћрЃЉрЃљ рЃЊрЃљрЃЉрЃћрЃГрЃЊрЃЋрЃљ
- рЃљрЃЕрЃЋрЃћрЃюрЃћрЃЉрЃА: рЃАрЃљрЃгрЃДрЃўрЃАрЃў, рЃюрЃљрЃдрЃЊрЃў, рЃЉрЃљрЃарЃљрЃЌрЃў, рЃЉрЃљрЃюрЃЎрЃў, рЃ«рЃљрЃарЃ»рЃћрЃЉрЃў, рЃЏрЃЮрЃАрЃљрЃџрЃЮрЃЊрЃюрЃћрЃџрЃў

---

## ­ЪЊі рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃўрЃА рЃгрЃДрЃљрЃарЃЮрЃћрЃЉрЃў

### 1. **Folio рЃњрЃљрЃЊрЃљрЃ«рЃЊрЃћрЃЉрЃў** (рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃў):
- **рЃгрЃДрЃљрЃарЃЮ**: `localStorage.getItem('hotelFolios')`
- **рЃцрЃўрЃџрЃбрЃарЃў**: `t.credit > 0` рЃЊрЃљ `t.date === Business Day`
- **рЃЏрЃћрЃЌрЃЮрЃЊрЃў**: `t.paymentMethod` (cash, card, bank)
- **рЃљрЃдрЃгрЃћрЃарЃљ**: `${folio.guestName} - Room ${folio.roomNumber}`

### 2. **рЃ«рЃћрЃџрЃўрЃЌ рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃћрЃЉрЃў**:
- **рЃгрЃДрЃљрЃарЃЮ**: `localStorage.getItem('cashierManualTransactions')`
- **рЃцрЃўрЃџрЃбрЃарЃў**: `t.date === Business Day`
- **рЃбрЃўрЃърЃћрЃЉрЃў**: `income` (рЃерЃћрЃЏрЃЮрЃАрЃљрЃЋрЃљрЃџрЃў) рЃљрЃю `expense` (рЃ«рЃљрЃарЃ»рЃў)

---

## ­Ъћё рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃўрЃА рЃърЃарЃўрЃюрЃфрЃўрЃърЃў

### Manual Refresh:
```typescript
// File: CashierModule.tsx:202
const handleRefresh = () => {
  // 1. рЃўрЃбрЃЋрЃўрЃарЃЌрЃћрЃЉрЃљ Folio рЃњрЃљрЃЊрЃљрЃ«рЃЊрЃћрЃЉрЃў Business Day-рЃќрЃћ
  const folios = JSON.parse(localStorage.getItem('hotelFolios') || '[]')
  const today = getBusinessDate()
  
  // 2. рЃўрЃбрЃЋрЃўрЃарЃЌрЃћрЃЉрЃљ рЃ«рЃћрЃџрЃўрЃЌ рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃћрЃЉрЃў
  const savedManual = JSON.parse(localStorage.getItem('cashierManualTransactions') || '[]')
  const todayManual = savedManual.filter((t: any) => t.date === today)
  
  // 3. рЃњрЃљрЃћрЃарЃЌрЃўрЃљрЃюрЃЊрЃћрЃЉрЃљ Folio + Manual рЃерЃћрЃЏрЃЮрЃАрЃљрЃЋрЃџрЃћрЃЉрЃў
  const allIncomes = [...folioPayments, ...manualIncomes]
  
  // 4. рЃњрЃљрЃюрЃљрЃ«рЃџрЃЊрЃћрЃЉрЃљ state
  setTransactions(allIncomes)
  setManualTransactions(manualExpenses)
  
  // 5. рЃњрЃљрЃюрЃљрЃ«рЃџрЃЊрЃћрЃЉрЃљ Shift-рЃўрЃА рЃбрЃЮрЃбрЃљрЃџрЃћрЃЉрЃў
  if (currentShift) {
    const updatedShift = {
      ...currentShift,
      cashCollected: totals.cash,
      cardPayments: totals.card,
      totalCollected: totals.total
    }
    localStorage.setItem('currentCashierShift', JSON.stringify(updatedShift))
  }
}
```

**рЃарЃЮрЃњрЃЮрЃа рЃЏрЃБрЃерЃљрЃЮрЃЉрЃА:**
- **­Ъћё рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃљ** рЃдрЃўрЃџрЃљрЃЎрЃў рЃљрЃ«рЃџрЃўрЃЊрЃљрЃю рЃўрЃбрЃЋрЃўрЃарЃЌрЃћрЃЉрЃљ рЃДрЃЋрЃћрЃџрЃљ рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃљ
- рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃљрЃњрЃарЃЮрЃЋрЃћрЃЉрЃА Folio рЃњрЃљрЃЊрЃљрЃ«рЃЊрЃћрЃЉрЃА
- рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃљрЃњрЃарЃЮрЃЋрЃћрЃЉрЃА рЃ«рЃћрЃџрЃўрЃЌ рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃћрЃЉрЃА
- рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃА Shift-рЃўрЃА рЃбрЃЮрЃбрЃљрЃџрЃћрЃЉрЃА

---

## ­ЪњЙ рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃўрЃА рЃерЃћрЃюрЃљрЃ«рЃЋрЃљ

### localStorage Keys:

1. **`currentCashierShift`** - рЃЏрЃўрЃЏрЃЊрЃўрЃюрЃљрЃарЃћ Shift (рЃЌрЃБ рЃдрЃўрЃљрЃљ)
   ```json
   {
     "id": "1234567890",
     "status": "open",
     "openingBalance": 1000,
     "cashCollected": 500,
     "cardPayments": 200,
     "openedAt": "2025-11-28T10:00:00Z"
   }
   ```

2. **`cashierShifts`** - Shift-рЃћрЃЉрЃўрЃА рЃўрЃАрЃбрЃЮрЃарЃўрЃљ (рЃЊрЃљрЃ«рЃБрЃарЃБрЃџрЃў)
   ```json
   [
     {
       "id": "1234567890",
       "status": "closed",
       "openingBalance": 1000,
       "cashCollected": 500,
       "actualAmount": 1500,
       "discrepancy": 0,
       "closedAt": "2025-11-28T18:00:00Z"
     }
   ]
   ```

3. **`cashierManualTransactions`** - рЃ«рЃћрЃџрЃўрЃЌ рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃћрЃЉрЃў
   ```json
   [
     {
       "id": "MANUAL-1234567890",
       "date": "2025-11-28",
       "type": "income",
       "amount": 100,
       "method": "cash",
       "manual": true
     }
   ]
   ```

---

## ­ЪЊІ рЃАрЃљрЃџрЃљрЃарЃЮрЃА рЃАрЃгрЃарЃљрЃцрЃў рЃЏрЃћрЃюрЃўрЃБ

### рЃФрЃўрЃарЃўрЃЌрЃљрЃЊрЃў рЃцрЃБрЃюрЃЦрЃфрЃўрЃћрЃЉрЃў:

1. **­Ъћё рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃљ** - рЃўрЃбрЃЋрЃўрЃарЃЌрЃћрЃЉрЃљ рЃДрЃЋрЃћрЃџрЃљ рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃљ Business Day-рЃќрЃћ
2. **­ЪЊі X-Report** - рЃЏрЃўрЃЏрЃЊрЃўрЃюрЃљрЃарЃћ Shift-рЃўрЃА рЃљрЃюрЃњрЃљрЃарЃўрЃерЃў (рЃЊрЃљрЃЉрЃћрЃГрЃЊрЃЋрЃљ рЃерЃћрЃАрЃљрЃФрЃџрЃћрЃЉрЃћрЃџрЃўрЃљ)
3. **РъЋ рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃљ** - рЃ«рЃћрЃџрЃўрЃЌ рЃерЃћрЃЏрЃЮрЃАрЃљрЃЋрЃџрЃўрЃА/рЃ«рЃљрЃарЃ»рЃўрЃА рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃљ
4. **­ЪЊю рЃўрЃАрЃбрЃЮрЃарЃўрЃљ** - рЃДрЃЋрЃћрЃџрЃљ рЃЊрЃљрЃ«рЃБрЃарЃБрЃџрЃў Shift-рЃўрЃА рЃАрЃўрЃљ

---

## ­Ъј» рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЋрЃљрЃюрЃў рЃгрЃћрЃАрЃћрЃЉрЃў

### 1. **Business Day рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃљ:**
- рЃАрЃљрЃџрЃљрЃарЃЮ рЃўрЃДрЃћрЃюрЃћрЃЉрЃА **Business Day**-рЃА (рЃљрЃарЃљ рЃЊрЃдрЃћрЃА!)
- Business Day = `localStorage.getItem('currentBusinessDate')` рЃљрЃю рЃЊрЃдрЃћрЃА
- рЃДрЃЋрЃћрЃџрЃљ рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃљ рЃцрЃўрЃџрЃбрЃарЃЊрЃћрЃЉрЃљ Business Day-рЃўрЃЌ

### 2. **рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃћрЃЉрЃўрЃА рЃбрЃўрЃърЃћрЃЉрЃў:**
- **`income`** (рЃерЃћрЃЏрЃЮрЃАрЃљрЃЋрЃљрЃџрЃў) Рєњ рЃЊрЃљрЃћрЃЏрЃљрЃбрЃћрЃЉрЃљ `transactions`-рЃА Рєњ рЃўрЃЌрЃЋрЃџрЃћрЃЉрЃљ cash/card/bank-рЃерЃў
- **`expense`** (рЃ«рЃљрЃарЃ»рЃў) Рєњ рЃЊрЃљрЃћрЃЏрЃљрЃбрЃћрЃЉрЃљ `manualTransactions`-рЃА Рєњ рЃњрЃљрЃЏрЃЮрЃљрЃЎрЃџрЃЊрЃћрЃЉрЃљ рЃерЃћрЃЏрЃЮрЃАрЃљрЃЋрЃљрЃџрЃА

### 3. **рЃњрЃљрЃЊрЃљрЃ«рЃЊрЃўрЃА рЃЏрЃћрЃЌрЃЮрЃЊрЃћрЃЉрЃў:**
- **`cash`** Рєњ рЃюрЃљрЃдрЃЊрЃў (рЃўрЃЌрЃЋрЃџрЃћрЃЉрЃљ рЃюрЃљрЃдрЃЊрЃў рЃЉрЃљрЃџрЃљрЃюрЃАрЃерЃў)
- **`card`** Рєњ рЃЉрЃљрЃарЃљрЃЌрЃў (рЃљрЃа рЃўрЃЌрЃЋрЃџрЃћрЃЉрЃљ рЃюрЃљрЃдрЃЊрЃў рЃЉрЃљрЃџрЃљрЃюрЃАрЃерЃў)
- **`bank`** Рєњ рЃЉрЃљрЃюрЃЎрЃў (рЃљрЃа рЃўрЃЌрЃЋрЃџрЃћрЃЉрЃљ рЃюрЃљрЃдрЃЊрЃў рЃЉрЃљрЃџрЃљрЃюрЃАрЃерЃў)

### 4. **Shift рЃЊрЃљрЃ«рЃБрЃарЃЋрЃўрЃА рЃцрЃЮрЃарЃЏрЃБрЃџрЃљ:**
```
рЃЏрЃЮрЃАрЃљрЃџрЃЮрЃЊрЃюрЃћрЃџрЃў рЃюрЃљрЃдрЃЊрЃў = рЃАрЃљрЃгрЃДрЃўрЃАрЃў рЃЉрЃљрЃџрЃљрЃюрЃАрЃў + рЃюрЃљрЃдрЃЊрЃў рЃерЃћрЃЏрЃЮрЃАрЃљрЃЋрЃљрЃџрЃў - рЃ«рЃљрЃарЃ»рЃћрЃЉрЃў
рЃАрЃ«рЃЋрЃљрЃЮрЃЉрЃљ = рЃцрЃљрЃЦрЃбрЃўрЃБрЃарЃў рЃюрЃљрЃдрЃЊрЃў - рЃЏрЃЮрЃАрЃљрЃџрЃЮрЃЊрЃюрЃћрЃџрЃў рЃюрЃљрЃдрЃЊрЃў
рЃњрЃљрЃАрЃљрЃбрЃљрЃюрЃў = рЃцрЃљрЃЦрЃбрЃўрЃБрЃарЃў рЃюрЃљрЃдрЃЊрЃў - рЃерЃћрЃЏрЃЊрЃћрЃњрЃў рЃЊрЃдрЃўрЃАрЃЌрЃЋрЃўрЃА рЃЊрЃљрЃбрЃЮрЃЋрЃћрЃЉрЃБрЃџрЃў
```

---

## Рџа№ИЈ рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЋрЃљрЃюрЃў рЃерЃћрЃюрЃўрЃерЃЋрЃюрЃћрЃЉрЃў

1. **Folio рЃњрЃљрЃЊрЃљрЃ«рЃЊрЃћрЃЉрЃў рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃўрЃЎрЃарЃўрЃЉрЃћрЃЉрЃљ** - рЃљрЃа рЃАрЃљрЃГрЃўрЃарЃЮрЃћрЃЉрЃА рЃ«рЃћрЃџрЃўрЃЌ рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃљрЃА
2. **рЃ«рЃћрЃџрЃўрЃЌ рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃћрЃЉрЃў** - рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃЊрЃћрЃърЃЮрЃќрЃўрЃбрЃћрЃЉрЃў, рЃгрЃўрЃюрЃљрЃАрЃгрЃљрЃарЃў рЃњрЃљрЃЊрЃљрЃ«рЃЊрЃћрЃЉрЃў, рЃ«рЃљрЃарЃ»рЃћрЃЉрЃў
3. **рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃљ** - рЃДрЃЮрЃЋрЃћрЃџрЃЌрЃЋрЃўрЃА рЃўрЃДрЃћрЃюрЃћрЃЉрЃА Business Day-рЃА (рЃљрЃарЃљ рЃЊрЃдрЃћрЃА!)
4. **Shift рЃЊрЃљрЃ«рЃБрЃарЃЋрЃўрЃАрЃљрЃА** - рЃДрЃЋрЃћрЃџрЃљ рЃбрЃарЃљрЃюрЃќрЃљрЃЦрЃфрЃўрЃљ рЃўрЃюрЃљрЃ«рЃћрЃЉрЃљ Shift-рЃЌрЃљрЃю рЃћрЃарЃЌрЃљрЃЊ рЃўрЃАрЃбрЃЮрЃарЃўрЃљрЃерЃў

---

**рЃЉрЃЮрЃџрЃЮ рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃљ**: 2025-11-28

