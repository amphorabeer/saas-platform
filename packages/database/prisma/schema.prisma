generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Tenant {
  id           String          @id @default(cuid())
  name         String
  slug         String          @unique
  plan         PlanType        @default(STARTER)
  isActive     Boolean         @default(true)
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  code         String          @unique
  legalName    String?
  taxId        String?
  phone        String?
  email        String?
  address      String?
  website      String?
  bankName     String?
  bankAccount  String?
  bankSwift    String?
  batches      Batch[]
  budgets      Budget[]
  customers    Customer[]
  Equipment    Equipment[]
  expenses     Expense[]
  inventory    InventoryItem[]
  invoices     Invoice[]
  Keg          Keg[]
  payments     Payment[]
  recipes      Recipe[]
  orders       SalesOrder[]
  suppliers    Supplier[]
  tanks        Tank[]
  transactions Transaction[]
  users        User[]
  stores       Store[]

  @@index([slug])
  @@index([code])
}

model User {
  id              String    @id @default(cuid())
  tenantId        String
  email           String
  name            String
  role            UserRole  @default(OPERATOR)
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  password        String?
  resetToken      String?
  resetTokenExpiry DateTime?
  tenant          Tenant    @relation(fields: [tenantId], references: [id])

  @@unique([tenantId, email])
  @@index([tenantId])
}

model Recipe {
  id          String             @id @default(cuid())
  tenantId    String
  createdBy   String?
  name        String
  style       String?
  abv         Decimal?           @db.Decimal(4, 2)
  ibu         Int?
  color       Int?
  og          Decimal?           @db.Decimal(5, 4)
  fg          Decimal?           @db.Decimal(5, 4)
  batchSize   Decimal?           @db.Decimal(10, 2)
  boilTime    Int?
  efficiency  Decimal?           @db.Decimal(5, 2)
  description String?
  notes       String?
  process     Json?
  status      RecipeStatus       @default(DRAFT)
  isActive    Boolean            @default(true)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  yeastStrain String?
  batches     Batch[]
  tenant      Tenant             @relation(fields: [tenantId], references: [id])
  ingredients RecipeIngredient[]

  @@unique([tenantId, name])
  @@index([tenantId, isActive])
}

model RecipeIngredient {
  id              String             @id @default(cuid())
  recipeId        String
  inventoryItemId String?
  name            String
  category        IngredientCategory
  amount          Decimal            @db.Decimal(10, 3)
  unit            String
  additionTime    Int?
  specs           Json?
  inventoryItem   InventoryItem?     @relation(fields: [inventoryItemId], references: [id])
  recipe          Recipe             @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@index([recipeId])
  @@index([inventoryItemId])
}

model InventoryItem {
  id                String             @id @default(cuid())
  tenantId          String
  sku               String
  name              String
  category          InventoryCategory  @default(RAW_MATERIAL)
  ingredientType    String?
  unit              String             @default("kg")
  reorderPoint      Decimal?           @db.Decimal(10, 3)
  supplier          String?
  location          String?
  specs             Json?
  cachedBalance     Decimal            @default(0) @db.Decimal(12, 3)
  costPerUnit       Decimal?           @db.Decimal(10, 4)
  balanceUpdatedAt  DateTime           @default(now())
  isActive          Boolean            @default(true)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  tenant            Tenant             @relation(fields: [tenantId], references: [id])
  ledger            InventoryLedger[]
  recipeIngredients RecipeIngredient[]

  @@unique([tenantId, sku])
  @@index([tenantId, category, isActive])
}

model InventoryLedger {
  id          String          @id @default(cuid())
  tenantId    String
  itemId      String
  quantity    Decimal         @db.Decimal(12, 3)
  type        LedgerEntryType
  batchId     String?
  orderId     String?
  packagingId String?
  notes       String?
  createdBy   String
  createdAt   DateTime        @default(now())
  batch       Batch?          @relation(fields: [batchId], references: [id])
  item        InventoryItem   @relation(fields: [itemId], references: [id], onDelete: Cascade)

  @@index([tenantId, itemId, createdAt])
  @@index([tenantId, batchId])
  @@index([tenantId, createdAt])
  @@index([itemId])
}

model IngredientCatalog {
  id        String   @id @default(cuid())
  type      String   @default("grain")
  name      String
  supplier  String?
  origin    String?
  specs     Json?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([type, isActive])
}

model Batch {
  id                    String            @id @default(cuid())
  tenantId              String
  batchNumber           String
  recipeId              String
  status                BatchStatus       @default(PLANNED)
  volume                Decimal           @db.Decimal(10, 2)
  packagedVolume        Decimal?          @default(0) @db.Decimal(10, 2)
  originalGravity       Decimal?          @db.Decimal(5, 4)
  currentGravity        Decimal?          @db.Decimal(5, 4)
  finalGravity          Decimal?          @db.Decimal(5, 4)
  abv                   Decimal?          @db.Decimal(4, 2)
  tankId                String?
  plannedDate           DateTime
  brewedAt              DateTime?
  fermentationStartedAt DateTime?
  conditioningStartedAt DateTime?
  readyAt               DateTime?
  completedAt           DateTime?
  createdBy             String
  notes                 String?
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt
  targetOg              Decimal?          @db.Decimal(5, 4)
  fermentationTankId    String?
  recipe                Recipe            @relation(fields: [recipeId], references: [id])
  tank                  Tank?             @relation(fields: [tankId], references: [id])
  tenant                Tenant            @relation(fields: [tenantId], references: [id])
  ingredients           BatchIngredient[]
  timeline              BatchTimeline[]
  gravityReadings       GravityReading[]
  ledgerEntries         InventoryLedger[]
  Keg                   Keg[]
  LotBatch              LotBatch[]
  packagingRuns         PackagingRun[]
  QCTest                QCTest[]

  @@unique([tenantId, batchNumber])
  @@index([tenantId, status])
  @@index([tenantId, tankId])
}

model BatchIngredient {
  id              String             @id @default(cuid())
  batchId         String
  inventoryItemId String?
  name            String
  category        IngredientCategory
  plannedAmount   Decimal            @db.Decimal(10, 3)
  actualAmount    Decimal?           @db.Decimal(10, 3)
  unit            String
  lotNumber       String?
  addedAt         DateTime?
  batch           Batch              @relation(fields: [batchId], references: [id], onDelete: Cascade)

  @@index([batchId])
}

model GravityReading {
  id          String   @id @default(cuid())
  batchId     String
  gravity     Decimal  @db.Decimal(5, 4)
  temperature Decimal  @db.Decimal(4, 1)
  notes       String?
  recordedBy  String
  recordedAt  DateTime @default(now())
  batch       Batch    @relation(fields: [batchId], references: [id], onDelete: Cascade)

  @@index([batchId, recordedAt])
}

model BatchTimeline {
  id          String            @id @default(cuid())
  batchId     String
  type        TimelineEventType
  title       String
  description String?
  data        Json?
  createdBy   String
  createdAt   DateTime          @default(now())
  batch       Batch             @relation(fields: [batchId], references: [id], onDelete: Cascade)

  @@index([batchId, createdAt])
}

model Tank {
  id                                   String           @id @default(cuid())
  tenantId                             String
  name                                 String
  type                                 TankType
  capacity                             Decimal          @db.Decimal(10, 2)
  status                               TankStatus       @default(AVAILABLE)
  currentBatchId                       String?
  location                             String?
  version                              Int              @default(0)
  createdAt                            DateTime         @default(now())
  updatedAt                            DateTime         @updatedAt
  capabilities                         TankCapability[] @default([])
  currentLotId                         String?
  currentPhase                         LotPhase?
  defaultTurnaroundHours               Int?             @default(4)
  maxFillPercent                       Int?             @default(95)
  minFillPercent                       Int?             @default(20)
  batches                              Batch[]
  LotReading                           LotReading[]
  tenant                               Tenant           @relation(fields: [tenantId], references: [id])
  TankAssignment                       TankAssignment[] @relation("TankAssignmentToTank")
  occupations                          TankOccupation[]
  Transfer_Transfer_destTankIdToTank   Transfer[]       @relation("Transfer_destTankIdToTank")
  Transfer_Transfer_sourceTankIdToTank Transfer[]       @relation("Transfer_sourceTankIdToTank")

  @@unique([tenantId, name])
  @@index([tenantId, status])
}

model TankOccupation {
  id        String          @id @default(cuid())
  tenantId  String
  tankId    String
  batchId   String
  phase     OccupationPhase
  startedAt DateTime        @default(now())
  endedAt   DateTime?
  tank      Tank            @relation(fields: [tankId], references: [id])

  @@index([tenantId, tankId, endedAt])
}

model PackagingRun {
  id          String      @id @default(cuid())
  tenantId    String
  batchId     String
  packageType PackageType
  quantity    Int
  volumeTotal Decimal     @db.Decimal(10, 2)
  lotNumber   String?
  performedBy String
  notes       String?
  performedAt DateTime    @default(now())
  batch       Batch       @relation(fields: [batchId], references: [id])

  @@index([tenantId, batchId])
}

model Customer {
  id                 String        @id @default(cuid())
  tenantId           String
  name               String
  type               CustomerType  @default(RETAIL)
  email              String?
  phone              String?
  address            String?
  city               String?
  taxId              String?
  kegReturnDays      Int           @default(14)
  kegDepositRequired Boolean       @default(true)
  isActive           Boolean       @default(true)
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
  tenant             Tenant        @relation(fields: [tenantId], references: [id])
  invoices           Invoice[]
  Keg                Keg[]
  orders             SalesOrder[]
  transactions       Transaction[]

  @@unique([tenantId, name])
  @@index([tenantId, isActive])
}

model Supplier {
  id           String        @id @default(cuid())
  tenantId     String
  name         String
  category     String?
  email        String?
  phone        String?
  address      String?
  city         String?
  taxId        String?
  bankAccount  String?
  notes        String?
  isActive     Boolean       @default(true)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  expenses     Expense[]
  invoices     Invoice[]
  tenant       Tenant        @relation(fields: [tenantId], references: [id])
  transactions Transaction[]

  @@unique([tenantId, name])
  @@index([tenantId, isActive])
}

model SalesOrder {
  id            String        @id @default(cuid())
  tenantId      String
  orderNumber   String
  customerId    String
  status        OrderStatus   @default(PENDING)
  paymentStatus PaymentStatus @default(PENDING)
  totalAmount   Decimal       @db.Decimal(12, 2)
  paidAmount    Decimal       @default(0) @db.Decimal(12, 2)
  notes         String?
  orderedAt     DateTime      @default(now())
  shippedAt     DateTime?
  deliveredAt   DateTime?
  createdBy     String
  updatedAt     DateTime      @updatedAt
  invoice       Invoice?
  items         OrderItem[]
  payments      Payment[]
  customer      Customer      @relation(fields: [customerId], references: [id])
  tenant        Tenant        @relation(fields: [tenantId], references: [id])
  transactions  Transaction[]

  @@unique([tenantId, orderNumber])
  @@index([tenantId, status])
  @@index([tenantId, customerId])
}

model OrderItem {
  id          String      @id @default(cuid())
  orderId     String
  productName String
  packageType PackageType
  quantity    Int
  unitPrice   Decimal     @db.Decimal(10, 2)
  totalPrice  Decimal     @db.Decimal(12, 2)
  batchId     String?
  order       SalesOrder  @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
}

model Transaction {
  id              String           @id @default(cuid())
  tenantId        String
  type            TransactionType
  date            DateTime         @default(now())
  amount          Decimal          @db.Decimal(12, 2)
  incomeCategory  IncomeCategory?
  expenseCategory ExpenseCategory?
  description     String?
  customerId      String?
  supplierId      String?
  orderId         String?
  invoiceId       String?
  expenseId       String?
  paymentId       String?
  paymentMethod   PaymentMethod?
  reference       String?
  notes           String?
  createdBy       String
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  customer        Customer?        @relation(fields: [customerId], references: [id])
  expense         Expense?         @relation(fields: [expenseId], references: [id])
  invoice         Invoice?         @relation(fields: [invoiceId], references: [id])
  order           SalesOrder?      @relation(fields: [orderId], references: [id])
  supplier        Supplier?        @relation(fields: [supplierId], references: [id])
  tenant          Tenant           @relation(fields: [tenantId], references: [id])

  @@index([tenantId, date])
  @@index([tenantId, type])
  @@index([tenantId, customerId])
  @@index([tenantId, supplierId])
}

model Invoice {
  id            String        @id @default(cuid())
  tenantId      String
  invoiceNumber String
  type          InvoiceType
  status        InvoiceStatus @default(DRAFT)
  issueDate     DateTime      @default(now())
  dueDate       DateTime?
  paidAt        DateTime?
  customerId    String?
  supplierId    String?
  orderId       String?       @unique
  subtotal      Decimal       @db.Decimal(12, 2)
  discount      Decimal       @default(0) @db.Decimal(12, 2)
  tax           Decimal       @default(0) @db.Decimal(12, 2)
  total         Decimal       @db.Decimal(12, 2)
  paidAmount    Decimal       @default(0) @db.Decimal(12, 2)
  notes         String?
  terms         String?
  createdBy     String
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  customer      Customer?     @relation(fields: [customerId], references: [id])
  order         SalesOrder?   @relation(fields: [orderId], references: [id])
  supplier      Supplier?     @relation(fields: [supplierId], references: [id])
  tenant        Tenant        @relation(fields: [tenantId], references: [id])
  items         InvoiceItem[]
  payments      Payment[]
  transactions  Transaction[]

  @@unique([tenantId, invoiceNumber])
  @@index([tenantId, status])
  @@index([tenantId, type])
  @@index([tenantId, customerId])
  @@index([tenantId, supplierId])
  @@index([tenantId, dueDate])
}

model InvoiceItem {
  id          String       @id @default(cuid())
  invoiceId   String
  description String
  quantity    Decimal      @db.Decimal(10, 3)
  unit        String?      @default("ცალი")
  unitPrice   Decimal      @db.Decimal(10, 2)
  total       Decimal      @db.Decimal(12, 2)
  productName String?
  packageType PackageType?
  batchId     String?
  sortOrder   Int          @default(0)
  invoice     Invoice      @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
}

model Payment {
  id        String        @id @default(cuid())
  tenantId  String
  invoiceId String?
  orderId   String?
  amount    Decimal       @db.Decimal(12, 2)
  method    PaymentMethod @default(BANK_TRANSFER)
  date      DateTime      @default(now())
  reference String?
  notes     String?
  createdBy String
  createdAt DateTime      @default(now())
  invoice   Invoice?      @relation(fields: [invoiceId], references: [id])
  order     SalesOrder?   @relation(fields: [orderId], references: [id])
  tenant    Tenant        @relation(fields: [tenantId], references: [id])

  @@index([tenantId, date])
  @@index([tenantId, invoiceId])
  @@index([tenantId, orderId])
}

model Expense {
  id            String          @id @default(cuid())
  tenantId      String
  category      ExpenseCategory
  supplierId    String?
  amount        Decimal         @db.Decimal(12, 2)
  date          DateTime        @default(now())
  description   String?
  invoiceNumber String?
  invoiceId     String?
  isPaid        Boolean         @default(false)
  paidAt        DateTime?
  paymentMethod PaymentMethod?
  receiptUrl    String?
  notes         String?
  createdBy     String
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  supplier      Supplier?       @relation(fields: [supplierId], references: [id])
  tenant        Tenant          @relation(fields: [tenantId], references: [id])
  transactions  Transaction[]

  @@index([tenantId, date])
  @@index([tenantId, category])
  @@index([tenantId, supplierId])
  @@index([tenantId, isPaid])
}

model Budget {
  id        String          @id @default(cuid())
  tenantId  String
  category  ExpenseCategory
  year      Int
  month     Int?
  amount    Decimal         @db.Decimal(12, 2)
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  tenant    Tenant          @relation(fields: [tenantId], references: [id])

  @@unique([tenantId, category, year, month])
  @@index([tenantId, year])
}

model AuditLog {
  id            String   @id @default(cuid())
  tenantId      String
  userId        String
  action        String
  entityType    String
  entityId      String
  oldData       Json?
  newData       Json?
  metadata      Json?
  correlationId String?
  ipAddress     String?
  userAgent     String?
  createdAt     DateTime @default(now())

  @@index([tenantId, entityType, entityId])
  @@index([tenantId, createdAt])
  @@index([tenantId, userId])
}

model BlendingConfig {
  id                    String   @id
  tenantId              String   @unique
  requireRecipeMatch    Boolean  @default(false)
  requireYeastMatch     Boolean  @default(true)
  requirePhaseMatch     Boolean  @default(true)
  requireStyleMatch     Boolean  @default(false)
  maxBlendSources       Int      @default(4)
  allowOverCapacity     Boolean  @default(false)
  maxAgeDifferenceHours Int      @default(48)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @default(now())
}

model CIPLog {
  id                   String    @id
  equipmentId          String
  cipType              String
  date                 DateTime
  duration             Int
  temperature          Float?
  causticConcentration Float?
  performedBy          String
  result               String
  notes                String?
  createdAt            DateTime  @default(now())
  Equipment            Equipment @relation(fields: [equipmentId], references: [id], onDelete: Cascade)

  @@index([date])
  @@index([equipmentId])
}

model Equipment {
  id                     String           @id
  tenantId               String
  name                   String
  type                   String
  status                 String           @default("OPERATIONAL")
  capacity               Int?
  model                  String?
  manufacturer           String?
  serialNumber           String?
  location               String?
  workingPressure        Float?
  currentTemp            Float?
  currentPressure        Float?
  installationDate       DateTime?
  warrantyDate           DateTime?
  lastCIP                DateTime?
  nextCIP                DateTime?
  lastMaintenance        DateTime?
  nextMaintenance        DateTime?
  cipIntervalDays        Int              @default(7)
  inspectionIntervalDays Int              @default(30)
  annualMaintenanceDays  Int              @default(365)
  currentBatchId         String?
  currentBatchNumber     String?
  notes                  String?
  createdAt              DateTime         @default(now())
  updatedAt              DateTime
  purchaseDate           DateTime?
  capabilities           String[]         @default([])
  CIPLog                 CIPLog[]
  Tenant                 Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  MaintenanceLog         MaintenanceLog[]
  ProblemReport          ProblemReport[]

  @@index([status])
  @@index([tenantId])
  @@index([type])
}

model Lot {
  id                                 String           @id
  tenantId                           String
  lotCode                            String?
  phase                              LotPhase         @default(FERMENTATION)
  status                             LotStatus        @default(PLANNED)
  plannedVolume                      Decimal          @db.Decimal(10, 2)
  actualVolume                       Decimal?         @db.Decimal(10, 2)
  notes                              String?
  parentLotId                        String?
  splitRatio                         Decimal?         @db.Decimal(5, 2)
  createdBy                          String
  createdAt                          DateTime         @default(now())
  updatedAt                          DateTime         @default(now())
  completedAt                        DateTime?
  lotNumber                          String?
  blendedAt                          DateTime?
  isBlendResult                      Boolean?         @default(false)
  splitAt                            DateTime?
  Lot                                Lot?             @relation("LotToLot", fields: [parentLotId], references: [id])
  other_Lot                          Lot[]            @relation("LotToLot")
  LotBatch                           LotBatch[]
  LotReading                         LotReading[]
  QCTest                             QCTest[]
  TankAssignment                     TankAssignment[]
  Transfer_Transfer_destLotIdToLot   Transfer[]       @relation("Transfer_destLotIdToLot")
  Transfer_Transfer_sourceLotIdToLot Transfer[]       @relation("Transfer_sourceLotIdToLot")

  @@unique([tenantId, lotCode])
  @@index([tenantId, status])
}

model LotBatch {
  id                 String   @id
  lotId              String
  batchId            String
  volumeContribution Decimal  @db.Decimal(10, 2)
  batchPercentage    Decimal  @default(100.00) @db.Decimal(5, 2)
  addedAt            DateTime @default(now())
  Batch              Batch    @relation(fields: [batchId], references: [id], onDelete: Cascade)
  Lot                Lot      @relation(fields: [lotId], references: [id], onDelete: Cascade)

  @@unique([lotId, batchId])
}

model LotReading {
  id          String      @id
  lotId       String
  tankId      String
  readingType ReadingType
  value       Decimal     @db.Decimal(10, 4)
  unit        String
  notes       String?
  recordedBy  String
  recordedAt  DateTime    @default(now())
  Lot         Lot         @relation(fields: [lotId], references: [id], onDelete: Cascade)
  Tank        Tank        @relation(fields: [tankId], references: [id], onDelete: Cascade)

  @@index([lotId, readingType])
}

model MaintenanceLog {
  id            String    @id
  equipmentId   String
  type          String
  status        String
  priority      String?
  scheduledDate DateTime?
  completedDate DateTime?
  duration      Int?
  performedBy   String?
  cost          Float?
  partsUsed     String[]
  description   String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime
  Equipment     Equipment @relation(fields: [equipmentId], references: [id], onDelete: Cascade)

  @@index([equipmentId])
  @@index([status])
}

model ProblemReport {
  id           String    @id
  equipmentId  String
  problemType  String
  severity     String
  status       String    @default("open")
  description  String
  reportedDate DateTime
  reportedBy   String
  resolvedDate DateTime?
  resolvedBy   String?
  resolution   String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime
  Equipment    Equipment @relation(fields: [equipmentId], references: [id], onDelete: Cascade)

  @@index([equipmentId])
  @@index([status])
}

model TankAssignment {
  id            String           @id
  tenantId      String
  tankId        String
  lotId         String
  phase         LotPhase
  plannedStart  DateTime?
  plannedEnd    DateTime?
  actualStart   DateTime?
  actualEnd     DateTime?
  status        AssignmentStatus @default(PLANNED)
  plannedVolume Decimal?         @db.Decimal(10, 2)
  actualVolume  Decimal?         @db.Decimal(10, 2)
  isBlendTarget Boolean          @default(false)
  isSplitSource Boolean          @default(false)
  createdBy     String?
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @default(now())
  startTime     DateTime?        @default(now())
  endTime       DateTime?        @default(now())
  notes         String?
  Lot           Lot              @relation(fields: [lotId], references: [id], onDelete: Cascade)
  Tank          Tank             @relation("TankAssignmentToTank", fields: [tankId], references: [id], onDelete: Cascade)

  @@index([tenantId, status])
  @@index([tenantId, tankId])
}

model Transfer {
  id                               String         @id
  tenantId                         String
  transferCode                     String
  sourceLotId                      String?
  sourceTankId                     String
  destLotId                        String?
  destTankId                       String
  transferType                     TransferType
  volume                           Decimal        @db.Decimal(10, 2)
  plannedAt                        DateTime
  executedAt                       DateTime?
  status                           TransferStatus @default(PLANNED)
  measuredLoss                     Decimal?       @db.Decimal(10, 2)
  lossReason                       String?
  performedBy                      String?
  notes                            String?
  createdAt                        DateTime       @default(now())
  updatedAt                        DateTime       @default(now())
  Lot_Transfer_destLotIdToLot      Lot?           @relation("Transfer_destLotIdToLot", fields: [destLotId], references: [id])
  Tank_Transfer_destTankIdToTank   Tank           @relation("Transfer_destTankIdToTank", fields: [destTankId], references: [id], onDelete: Cascade)
  Lot_Transfer_sourceLotIdToLot    Lot?           @relation("Transfer_sourceLotIdToLot", fields: [sourceLotId], references: [id])
  Tank_Transfer_sourceTankIdToTank Tank           @relation("Transfer_sourceTankIdToTank", fields: [sourceTankId], references: [id], onDelete: Cascade)

  @@unique([tenantId, transferCode])
}

model Keg {
  id          String        @id @default(cuid())
  tenantId    String
  kegNumber   String
  size        Int
  status      KegStatus     @default(AVAILABLE)
  condition   KegCondition  @default(GOOD)
  batchId     String?
  filledAt    DateTime?
  productName String?
  lotNumber   String?
  customerId  String?
  orderId     String?
  sentAt      DateTime?
  returnedAt  DateTime?
  deposit     Decimal       @default(150) @db.Decimal(10, 2)
  notes       String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @default(now()) @updatedAt
  Batch       Batch?        @relation(fields: [batchId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  Customer    Customer?     @relation(fields: [customerId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  Tenant      Tenant        @relation(fields: [tenantId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  movements   KegMovement[]

  @@unique([tenantId, kegNumber])
  @@index([tenantId, customerId])
  @@index([tenantId, status])
}

model KegMovement {
  id           String    @id @default(cuid())
  tenantId     String
  kegId        String
  action       KegAction
  fromStatus   KegStatus
  toStatus     KegStatus
  productId    String?
  productName  String?
  customerId   String?
  customerName String?
  orderId      String?
  batchId      String?
  notes        String?
  createdAt    DateTime  @default(now())
  createdBy    String?
  keg          Keg       @relation(fields: [kegId], references: [id], onDelete: Cascade)

  @@index([tenantId, kegId])
  @@index([tenantId, customerId])
  @@index([tenantId, createdAt])
}

model QCTest {
  id            String         @id
  tenantId      String
  batchId       String
  lotId         String?
  testType      QCTestType
  status        QCTestStatus   @default(SCHEDULED)
  priority      QCTestPriority @default(MEDIUM)
  scheduledDate DateTime
  completedDate DateTime?
  minValue      Decimal?       @db.Decimal(10, 4)
  maxValue      Decimal?       @db.Decimal(10, 4)
  targetValue   Decimal?       @db.Decimal(10, 4)
  result        Decimal?       @db.Decimal(10, 4)
  unit          String?
  notes         String?
  performedBy   String?
  createdBy     String
  createdAt     DateTime       @default(now())
  updatedAt     DateTime
  Batch         Batch          @relation(fields: [batchId], references: [id], onDelete: Cascade)
  Lot           Lot?           @relation(fields: [lotId], references: [id], onDelete: Cascade)

  @@index([scheduledDate])
  @@index([tenantId, batchId])
  @@index([tenantId, status])
}

enum PlanType {
  STARTER
  PROFESSIONAL
  ENTERPRISE
}

enum UserRole {
  OWNER
  ADMIN
  MANAGER
  OPERATOR
  VIEWER
}

enum InventoryCategory {
  RAW_MATERIAL
  PACKAGING
  FINISHED_GOOD
  CONSUMABLE
}

enum LedgerEntryType {
  PURCHASE
  CONSUMPTION
  PRODUCTION
  ADJUSTMENT
  ADJUSTMENT_ADD
  ADJUSTMENT_REMOVE
  WASTE
  SALE
  RETURN
  REVERSAL
  TRANSFER
}

enum IngredientCategory {
  MALT
  HOPS
  YEAST
  ADJUNCT
  WATER_CHEMISTRY
}

enum BatchStatus {
  PLANNED
  BREWING
  FERMENTING
  CONDITIONING
  READY
  PACKAGING
  COMPLETED
  CANCELLED
}

enum TimelineEventType {
  CREATED
  STARTED
  MASH
  BOIL
  TRANSFER
  GRAVITY_READING
  DRY_HOP
  TEMPERATURE_CHANGE
  NOTE
  COMPLETED
  INGREDIENTS_RESERVED
  BREWING_STARTED
  MASH_COMPLETE
  BOIL_COMPLETE
  TRANSFER_TO_FERMENTER
  FERMENTATION_STARTED
  DRY_HOP_ADDED
  CONDITIONING_STARTED
  READY_FOR_PACKAGING
  PACKAGING_STARTED
  PACKAGING_COMPLETE
  CANCELLED
}

enum TankType {
  FERMENTER
  BRITE
  UNITANK
  KETTLE
  MASH_TUN
  HLT
}

enum TankStatus {
  AVAILABLE
  OCCUPIED
  CLEANING
  MAINTENANCE
  OUT_OF_SERVICE
}

enum OccupationPhase {
  FERMENTATION
  CONDITIONING
  STORAGE
}

enum PackageType {
  KEG_50
  KEG_30
  KEG_20
  BOTTLE_750
  BOTTLE_500
  BOTTLE_330
  CAN_500
  CAN_330
}

enum CustomerType {
  RETAIL
  WHOLESALE
  DISTRIBUTOR
  RESTAURANT
  BAR
  EXPORT
}

enum OrderStatus {
  DRAFT
  PENDING
  CONFIRMED
  PROCESSING
  READY
  SHIPPED
  DELIVERED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  PARTIAL
  PAID
  OVERDUE
  REFUNDED
}

enum AssignmentStatus {
  PLANNED
  ACTIVE
  COMPLETED
  CANCELLED
}

enum EquipmentStatus {
  OPERATIONAL
  NEEDS_MAINTENANCE
  UNDER_MAINTENANCE
  OUT_OF_SERVICE
  NEEDS_CIP
}

enum EquipmentType {
  FERMENTER
  UNITANK
  BRITE
  KETTLE
  MASH_TUN
  HLT
  PUMP
  CHILLER
  FILTER
  OTHER
}

enum LotPhase {
  FERMENTATION
  CONDITIONING
  BRIGHT
  PACKAGING
}

enum LotStatus {
  PLANNED
  ACTIVE
  COMPLETED
  CANCELLED
}

enum ReadingType {
  GRAVITY
  TEMPERATURE
  PH
  PRESSURE
  DISSOLVED_O2
  TURBIDITY
}

enum RecipeStatus {
  DRAFT
  ACTIVE
  ARCHIVED
}

enum TankCapability {
  FERMENTING
  CONDITIONING
  BREWING
  BRIGHT
  STORAGE
}

enum TransferStatus {
  PLANNED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum TransferType {
  FERMENT_TO_CONDITION
  CONDITION_TO_BRIGHT
  TANK_TO_TANK
  BLEND
  SPLIT
}

enum KegCondition {
  GOOD
  NEEDS_CLEANING
  DAMAGED
}

enum KegStatus {
  AVAILABLE
  FILLED
  WITH_CUSTOMER
  IN_TRANSIT
  CLEANING
  DAMAGED
  LOST
}

enum KegAction {
  CREATED
  FILLED
  SHIPPED
  RETURNED
  CLEANED
  DAMAGED
  LOST
  REPAIRED
}

enum QCTestPriority {
  HIGH
  MEDIUM
  LOW
}

enum QCTestStatus {
  SCHEDULED
  IN_PROGRESS
  PASSED
  WARNING
  FAILED
  CANCELLED
}

enum QCTestType {
  GRAVITY
  TEMPERATURE
  PH
  DISSOLVED_O2
  TURBIDITY
  COLOR
  BITTERNESS
  ALCOHOL
  CARBONATION
  APPEARANCE
  AROMA
  TASTE
  MICROBIOLOGICAL
}

enum TransactionType {
  INCOME
  EXPENSE
  TRANSFER
}

enum IncomeCategory {
  SALE
  DEPOSIT
  REFUND
  OTHER
}

enum ExpenseCategory {
  INGREDIENTS
  PACKAGING
  EQUIPMENT
  UTILITIES
  SALARY
  RENT
  MARKETING
  MAINTENANCE
  TRANSPORT
  OTHER
}

enum InvoiceType {
  OUTGOING
  INCOMING
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  PARTIAL
  OVERDUE
  CANCELLED
}

enum PaymentMethod {
  CASH
  BANK_TRANSFER
  CARD
  CHECK
}

model Configuration {
  id        String   @id @default(cuid())
  key       String   @unique
  value     Json
  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())

  @@index([key])
}

// GeoGuide – მუზეუმი
model Museum {
  id            String   @id @default(cuid())

  // Georgian (default)
  name          String
  description   String?  @db.Text
  city          String?
  address       String?

  // English
  nameEn        String?
  descriptionEn String?  @db.Text
  cityEn        String?
  addressEn     String?

  // Russian
  nameRu        String?
  descriptionRu String?  @db.Text
  cityRu        String?
  addressRu     String?

  // German
  nameDe        String?
  descriptionDe String?  @db.Text
  cityDe        String?
  addressDe     String?

  // French
  nameFr        String?
  descriptionFr String?  @db.Text
  cityFr        String?
  addressFr     String?

  // Common fields (same for all languages)
  slug          String   @unique
  coverImage    String?
  latitude      Float?
  longitude     Float?
  contactEmail  String?
  contactPhone  String?
  website       String?

  // Settings
  showMap       Boolean  @default(false)
  showQrScanner Boolean  @default(false)
  isPublished   Boolean  @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tours Tour[]

  @@map("geoguide_museums")
}

// GeoGuide – ტური (მინიმალური მოდელი Museum რელაციისთვის)
model Tour {
  id        String   @id @default(cuid())
  museumId  String
  museum    Museum   @relation(fields: [museumId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([museumId])
  @@map("geoguide_tours")
}

// ==========================================
// STORE / POS MODULE
// ==========================================

model Store {
  id             String    @id @default(cuid())
  tenantId       String
  name           String
  slug           String    @unique
  address        String?
  phone          String?
  email          String?
  taxId          String?
  currency       String    @default("GEL")
  timezone       String    @default("Asia/Tbilisi")
  logoUrl        String?
  isActive       Boolean   @default(true)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  tenant         Tenant    @relation(fields: [tenantId], references: [id])
  products       StoreProduct[]
  categories     ProductCategory[]
  sales          Sale[]
  purchases      StorePurchaseOrder[]
  suppliers      StoreSupplier[]
  customers      StoreCustomer[]
  employees      StoreEmployee[]
  stockMovements    StockMovement[]
  taxRules          StoreTaxRule[]
  loyaltyConfig     StoreLoyaltyConfig?
  transferOrdersOut TransferOrder[]  @relation("TransferFromStore")
  transferOrdersIn  TransferOrder[]  @relation("TransferToStore")
  paymentMethods StorePaymentConfig[]
  receiptConfig  StoreReceiptConfig?
  devices        StoreDeviceConfig[]
  integrations   StoreIntegration[]

  @@index([tenantId])
}

// ── PRODUCTS ──

model ProductCategory {
  id          String    @id @default(cuid())
  storeId     String
  name        String
  nameKa      String?
  slug        String
  description String?
  color       String?
  icon        String?
  sortOrder   Int       @default(0)
  parentId    String?
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  store       Store     @relation(fields: [storeId], references: [id], onDelete: Cascade)
  parent      ProductCategory?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children    ProductCategory[] @relation("CategoryHierarchy")
  products    StoreProduct[]

  @@unique([storeId, slug])
  @@index([storeId])
}

model StoreProduct {
  id             String    @id @default(cuid())
  storeId        String
  categoryId     String?
  sku            String
  barcode        String?
  name           String
  nameKa         String?
  description    String?
  imageUrl       String?
  costPrice      Decimal   @db.Decimal(10, 2)
  sellingPrice   Decimal   @db.Decimal(10, 2)
  wholesalePrice Decimal?  @db.Decimal(10, 2)
  currentStock   Decimal   @default(0) @db.Decimal(10, 3)
  minStock       Decimal   @default(0) @db.Decimal(10, 3)
  maxStock       Decimal?  @db.Decimal(10, 3)
  unit           String    @default("piece")
  taxRuleId      String?
  isActive       Boolean   @default(true)
  isFavorite     Boolean   @default(false)
  sortOrder      Int       @default(0)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  store          Store     @relation(fields: [storeId], references: [id], onDelete: Cascade)
  category       ProductCategory? @relation(fields: [categoryId], references: [id])
  taxRule        StoreTaxRule?    @relation(fields: [taxRuleId], references: [id])
  saleItems       SaleItem[]
  saleReturnItems SaleReturnItem[]
  purchaseItems   StorePurchaseItem[]
  stockMovements    StockMovement[]
  priceHistory      StorePriceHistory[]
  transferOrderItems TransferOrderItem[]

  @@unique([storeId, sku])
  @@index([storeId])
  @@index([categoryId])
  @@index([barcode])
}

model StorePriceHistory {
  id           String    @id @default(cuid())
  productId    String
  costPrice    Decimal   @db.Decimal(10, 2)
  sellingPrice Decimal   @db.Decimal(10, 2)
  changedBy    String?
  changedAt    DateTime  @default(now())

  product      StoreProduct @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
}

// ── SALES / POS ──

model Sale {
  id             String          @id @default(cuid())
  storeId        String
  saleNumber     String
  customerId     String?
  employeeId     String?
  subtotal       Decimal         @db.Decimal(10, 2)
  taxAmount      Decimal         @default(0) @db.Decimal(10, 2)
  discountAmount Decimal         @default(0) @db.Decimal(10, 2)
  discountType   StoreDiscountType?
  total          Decimal         @db.Decimal(10, 2)
  paidAmount     Decimal         @db.Decimal(10, 2)
  changeAmount   Decimal         @default(0) @db.Decimal(10, 2)
  status         StoreSaleStatus @default(COMPLETED)
  notes          String?
  receiptPrinted Boolean         @default(false)
  fiscalPrinted  Boolean         @default(false)
  fiscalNumber   String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt

  store          Store           @relation(fields: [storeId], references: [id], onDelete: Cascade)
  customer       StoreCustomer?  @relation(fields: [customerId], references: [id])
  employee       StoreEmployee?  @relation(fields: [employeeId], references: [id])
  items          SaleItem[]
  payments       SalePayment[]
  returns        SaleReturn[]

  @@unique([storeId, saleNumber])
  @@index([storeId])
  @@index([storeId, createdAt])
  @@index([customerId])
}

model SaleItem {
  id          String    @id @default(cuid())
  saleId      String
  productId   String
  productName String
  quantity    Decimal   @db.Decimal(10, 3)
  unitPrice   Decimal   @db.Decimal(10, 2)
  costPrice   Decimal   @db.Decimal(10, 2)
  discount    Decimal   @default(0) @db.Decimal(10, 2)
  taxAmount   Decimal   @default(0) @db.Decimal(10, 2)
  total       Decimal   @db.Decimal(10, 2)

  sale        Sale         @relation(fields: [saleId], references: [id], onDelete: Cascade)
  product     StoreProduct @relation(fields: [productId], references: [id])

  @@index([saleId])
  @@index([productId])
}

model SalePayment {
  id        String        @id @default(cuid())
  saleId    String
  method    PaymentMethod
  amount    Decimal       @db.Decimal(10, 2)
  reference String?
  createdAt DateTime      @default(now())

  sale      Sale          @relation(fields: [saleId], references: [id], onDelete: Cascade)

  @@index([saleId])
}

model SaleReturn {
  id           String            @id @default(cuid())
  saleId       String
  reason       String
  refundAmount Decimal           @db.Decimal(10, 2)
  refundMethod PaymentMethod
  status       StoreReturnStatus @default(STORE_RETURN_PENDING)
  createdAt    DateTime          @default(now())
  processedAt  DateTime?

  sale         Sale              @relation(fields: [saleId], references: [id], onDelete: Cascade)
  items        SaleReturnItem[]

  @@index([saleId])
}

model SaleReturnItem {
  id           String     @id @default(cuid())
  returnId     String
  productId    String
  quantity     Decimal    @db.Decimal(10, 3)
  refundAmount Decimal    @db.Decimal(10, 2)

  saleReturn   SaleReturn  @relation(fields: [returnId], references: [id], onDelete: Cascade)
  product      StoreProduct @relation(fields: [productId], references: [id])

  @@index([returnId])
  @@index([productId])
}

// ── PURCHASES / SUPPLIERS ──

model StoreSupplier {
  id            String    @id @default(cuid())
  storeId       String
  name          String
  contactPerson String?
  phone         String?
  email         String?
  address       String?
  taxId         String?
  bankAccount   String?
  notes         String?
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  store          Store     @relation(fields: [storeId], references: [id], onDelete: Cascade)
  purchaseOrders StorePurchaseOrder[]

  @@unique([storeId, name])
  @@index([storeId])
}

model StorePurchaseOrder {
  id           String              @id @default(cuid())
  storeId      String
  supplierId   String
  orderNumber  String
  subtotal     Decimal             @db.Decimal(10, 2)
  taxAmount    Decimal             @default(0) @db.Decimal(10, 2)
  total        Decimal             @db.Decimal(10, 2)
  status       StorePurchaseStatus @default(STORE_PO_DRAFT)
  notes        String?
  expectedDate DateTime?
  receivedDate DateTime?
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt

  store        Store               @relation(fields: [storeId], references: [id], onDelete: Cascade)
  supplier     StoreSupplier       @relation(fields: [supplierId], references: [id])
  items        StorePurchaseItem[]

  @@unique([storeId, orderNumber])
  @@index([storeId])
  @@index([supplierId])
}

model StorePurchaseItem {
  id              String             @id @default(cuid())
  purchaseOrderId String
  productId       String
  quantity        Decimal            @db.Decimal(10, 3)
  unitCost        Decimal            @db.Decimal(10, 2)
  receivedQty     Decimal            @default(0) @db.Decimal(10, 3)
  total           Decimal            @db.Decimal(10, 2)

  purchaseOrder   StorePurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
  product         StoreProduct       @relation(fields: [productId], references: [id])

  @@index([purchaseOrderId])
  @@index([productId])
}

// ── INVENTORY ──

model StockMovement {
  id            String            @id @default(cuid())
  storeId       String
  productId     String
  type          StoreMovementType
  quantity      Decimal           @db.Decimal(10, 3)
  previousStock Decimal           @db.Decimal(10, 3)
  newStock      Decimal           @db.Decimal(10, 3)
  reason        String?
  referenceType String?
  referenceId   String?
  performedBy   String?
  createdAt     DateTime          @default(now())

  store         Store             @relation(fields: [storeId], references: [id], onDelete: Cascade)
  product       StoreProduct      @relation(fields: [productId], references: [id])

  @@index([storeId])
  @@index([productId])
  @@index([storeId, createdAt])
}

model TransferOrder {
  id             String              @id @default(cuid())
  fromStoreId    String
  toStoreId      String
  transferNumber String
  status         TransferOrderStatus @default(DRAFT)
  notes          String?
  sentAt         DateTime?
  receivedAt     DateTime?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt

  fromStore      Store               @relation("TransferFromStore", fields: [fromStoreId], references: [id], onDelete: Cascade)
  toStore        Store               @relation("TransferToStore", fields: [toStoreId], references: [id], onDelete: Cascade)
  items          TransferOrderItem[]
}

model TransferOrderItem {
  id              String        @id @default(cuid())
  transferOrderId String
  productId       String
  quantity        Decimal       @db.Decimal(10, 3)
  unitCost        Decimal?      @db.Decimal(10, 2)

  transferOrder   TransferOrder @relation(fields: [transferOrderId], references: [id], onDelete: Cascade)
  product         StoreProduct  @relation(fields: [productId], references: [id])

  @@index([transferOrderId])
  @@index([productId])
}

enum TransferOrderStatus {
  DRAFT
  SENT
  RECEIVED
}

// ── CUSTOMERS ──

model StoreCustomer {
  id                    String            @id @default(cuid())
  storeId               String
  firstName             String
  lastName              String?
  phone                 String?
  email                 String?
  address               String?
  taxId                 String?
  notes                 String?
  totalPurchases        Decimal           @default(0) @db.Decimal(10, 2)
  loyaltyPoints         Int               @default(0)
  loyaltyTier           LoyaltyTier       @default(BRONZE)
  totalLifetimePurchases Decimal          @default(0) @db.Decimal(12, 2)
  isActive              Boolean           @default(true)
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt

  store                 Store             @relation(fields: [storeId], references: [id], onDelete: Cascade)
  sales                 Sale[]
  loyaltyTransactions   StoreLoyaltyTransaction[]

  @@index([storeId])
  @@index([phone])
}

enum LoyaltyTier {
  BRONZE
  SILVER
  GOLD
  PLATINUM
}

model StoreLoyaltyConfig {
  id                  String    @id @default(cuid())
  storeId             String    @unique
  pointsPerGel        Int       @default(1)
  redemptionRate      Int       @default(100)
  minRedemptionPoints Int       @default(100)
  expirationDays      Int?
  bronzeMinSpend      Decimal?  @db.Decimal(12, 2)
  silverMinSpend      Decimal?  @db.Decimal(12, 2)
  goldMinSpend        Decimal?  @db.Decimal(12, 2)
  platinumMinSpend    Decimal?  @db.Decimal(12, 2)
  goldDiscountPercent Decimal?  @db.Decimal(5, 2)
  platinumDiscountPercent Decimal? @db.Decimal(5, 2)

  store               Store     @relation(fields: [storeId], references: [id], onDelete: Cascade)
}

model StoreLoyaltyTransaction {
  id          String                 @id @default(cuid())
  customerId  String
  type        LoyaltyTransactionType
  points      Int
  saleId      String?
  description String?
  createdAt   DateTime               @default(now())

  customer    StoreCustomer          @relation(fields: [customerId], references: [id], onDelete: Cascade)
}

enum LoyaltyTransactionType {
  EARN
  REDEEM
  ADJUST
  EXPIRE
}

// ── EMPLOYEES ──

model StoreEmployee {
  id        String    @id @default(cuid())
  storeId   String
  userId    String?
  firstName String
  lastName  String
  phone     String?
  email     String?
  role      StoreRole @default(STORE_CASHIER)
  pin       String?
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  store     Store     @relation(fields: [storeId], references: [id], onDelete: Cascade)
  sales     Sale[]

  @@index([storeId])
}

// ── SETTINGS ──

model StoreTaxRule {
  id        String    @id @default(cuid())
  storeId   String
  name      String
  rate      Decimal   @db.Decimal(5, 2)
  isDefault Boolean   @default(false)
  isActive  Boolean   @default(true)

  store     Store     @relation(fields: [storeId], references: [id], onDelete: Cascade)
  products  StoreProduct[]

  @@index([storeId])
}

model StorePaymentConfig {
  id        String        @id @default(cuid())
  storeId   String
  name      String
  type      PaymentMethod
  isActive  Boolean       @default(true)
  sortOrder Int           @default(0)

  store     Store         @relation(fields: [storeId], references: [id], onDelete: Cascade)

  @@index([storeId])
}

model StoreReceiptConfig {
  id         String    @id @default(cuid())
  storeId    String    @unique
  headerText String?
  footerText String?
  showLogo   Boolean   @default(true)
  showTaxId  Boolean   @default(true)
  showBarcode Boolean  @default(false)
  paperWidth Int       @default(80)

  store      Store     @relation(fields: [storeId], references: [id], onDelete: Cascade)
}

// ── DEVICES & INTEGRATIONS ──

model StoreDeviceConfig {
  id             String          @id @default(cuid())
  storeId        String
  deviceType     StoreDeviceType
  name           String
  connectionType String
  settings       Json
  isActive       Boolean         @default(true)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt

  store          Store           @relation(fields: [storeId], references: [id], onDelete: Cascade)

  @@index([storeId])
}

model StoreIntegration {
  id          String               @id @default(cuid())
  storeId     String
  type        StoreIntegrationType
  name        String
  credentials Json?
  settings    Json?
  lastSyncAt  DateTime?
  isActive    Boolean              @default(true)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt

  store       Store                @relation(fields: [storeId], references: [id], onDelete: Cascade)

  @@index([storeId])
}

// ── STORE ENUMS ──

enum StoreSaleStatus {
  COMPLETED
  VOIDED
  REFUNDED
  PARTIAL_REFUND
}

enum StoreReturnStatus {
  STORE_RETURN_PENDING
  STORE_RETURN_APPROVED
  STORE_RETURN_COMPLETED
  STORE_RETURN_REJECTED
}

enum StorePurchaseStatus {
  STORE_PO_DRAFT
  STORE_PO_ORDERED
  STORE_PO_PARTIAL
  STORE_PO_RECEIVED
  STORE_PO_CANCELLED
}

enum StoreMovementType {
  STOCK_IN
  STOCK_OUT
  STOCK_ADJUSTMENT
  STOCK_TRANSFER
  STOCK_RETURN
}

enum StoreDiscountType {
  DISCOUNT_PERCENTAGE
  DISCOUNT_FIXED
}

enum StoreRole {
  STORE_OWNER
  STORE_MANAGER
  STORE_CASHIER
  STORE_INVENTORY_CLERK
}

enum StoreDeviceType {
  RECEIPT_PRINTER
  FISCAL_PRINTER
  BARCODE_SCANNER
  WEIGHT_SCALE
  CASH_DRAWER
  BANK_TERMINAL
  CUSTOMER_DISPLAY
}

enum StoreIntegrationType {
  RS_GE
  WOOCOMMERCE
  SHOPIFY
  GLOVO
  EXTRA_GE
  BANK_TBC
  BANK_BOG
  BANK_LIBERTY
}